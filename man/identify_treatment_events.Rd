% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/impact_evaluation.R
\name{identify_treatment_events}
\alias{identify_treatment_events}
\title{Identify Treatment Groups for Impact Evaluation}
\usage{
identify_treatment_events(
  data,
  treatment_conditions,
  event_window = c(-365, 365),
  min_pre_period = 90,
  min_post_period = 90,
  multiple_events = "first",
  require_employment_before = TRUE,
  id_column = "cf",
  date_column = "inizio"
)
}
\arguments{
\item{data}{A data.table containing employment records (output from vecshift)}

\item{treatment_conditions}{List of conditions defining treatment events.
Each condition can be:
- A string expression (e.g., "COD_TIPOLOGIA_CONTRATTUALE == 'C.01.00'")
- A named list with 'column', 'operator', and 'value'
- A function that takes the data and returns a logical vector}

\item{event_window}{Numeric vector of length 2 defining the event window
relative to the treatment date. Default: c(-365, 365) (1 year before/after)}

\item{min_pre_period}{Minimum number of days required before the event.
Default: 90}

\item{min_post_period}{Minimum number of days required after the event.
Default: 90}

\item{multiple_events}{How to handle multiple treatment events per person:
- "first": Use only the first treatment event date
- "last": Use only the last treatment event date
- "all": Keep all treatment events (creates multiple treatment dates per person)
Default: "first"}

\item{require_employment_before}{Logical. Require employment before the treatment event?
Default: TRUE}

\item{id_column}{Character. Name of the person identifier column. Default: "cf"}

\item{date_column}{Character. Name of the date column to use for event timing.
Default: "inizio"}
}
\value{
A data.table with ALL employment events for both treated and control people including:
  \item{cf}{Person identifier}
  \item{is_treated}{Logical indicator: TRUE for people who experienced treatment, FALSE for controls}
  \item{treatment_event_date}{Date of first/last treatment event (NA for control people)}
  \item{days_to_event}{Days from each observation to treatment event (negative = before)}
  \item{in_event_window}{Logical indicator for observations within event window}
  \item{pre_event_period}{Logical indicator for pre-treatment observations}
  \item{post_event_period}{Logical indicator for post-treatment observations}
  \item{treatment_condition_met}{Description of which condition triggered treatment}
  \item{...}{All original employment data columns}
}
\description{
Identifies people who experienced treatment events and collects their complete
employment histories for impact evaluation. Uses a person-centered approach that
compares entire career trajectories of treated vs. control individuals.
}
\examples{
\dontrun{
# Identify people who got permanent contracts and collect their full careers
impact_data <- identify_treatment_events(
  data = employment_data,
  treatment_conditions = list("COD_TIPOLOGIA_CONTRATTUALE == 'C.01.00'"),
  event_window = c(-180, 365),
  multiple_events = "first"
)

# Result contains:
# - ALL employment events for people who got permanent contracts (is_treated=TRUE)
# - ALL employment events for people who never got permanent contracts (is_treated=FALSE)
# - treatment_event_date marks when treated people first got permanent contracts

# Multiple conditions example
impact_data <- identify_treatment_events(
  data = employment_data,
  treatment_conditions = list(
    list(column = "COD_TIPOLOGIA_CONTRATTUALE", operator = "==", value = "C.01.00"),
    list(column = "durata", operator = ">", value = 365)
  ),
  event_window = c(-365, 730)
)
}

}
