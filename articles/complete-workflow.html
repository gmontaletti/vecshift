<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Complete Workflow: From Raw Data to Analysis • vecshift</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Complete Workflow: From Raw Data to Analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">vecshift</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/complete-workflow.html">Complete Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/understanding-date-logic.html">Understanding Date Logic</a></li>
    <li><a class="dropdown-item" href="../articles/status-classification.html">Employment Status Classification</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gmontaletti/vecshift/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Complete Workflow: From Raw Data to Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gmontaletti/vecshift/blob/main/vignettes/complete-workflow.Rmd" class="external-link"><code>vignettes/complete-workflow.Rmd</code></a></small>
      <div class="d-none name"><code>complete-workflow.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gmontaletti.github.io/vecshift/">vecshift</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The vecshift package provides a comprehensive system for processing
temporal employment data, transforming raw employment records into
continuous time segments with employment status classifications and
overlap consolidation. This vignette walks through a complete workflow
from raw data preparation to advanced analysis, demonstrating best
practices and common patterns.</p>
<div class="section level3">
<h3 id="what-you-will-learn">What You Will Learn<a class="anchor" aria-label="anchor" href="#what-you-will-learn"></a>
</h3>
<p>This tutorial covers:</p>
<ul>
<li>Data validation and quality assessment</li>
<li>Cleaning and standardization</li>
<li>Core temporal transformation with vecshift()</li>
<li>Employment status classification</li>
<li>Quality validation and pattern analysis</li>
<li>Advanced features (external events, merging consecutive
periods)</li>
<li>Pipeline processing for production workflows</li>
</ul>
</div>
<div class="section level3">
<h3 id="the-workflow-overview">The Workflow Overview<a class="anchor" aria-label="anchor" href="#the-workflow-overview"></a>
</h3>
<pre><code>Raw Data → Validate → Clean → Standardize → vecshift() → Classify → Analyze</code></pre>
<p>The vecshift workflow follows a systematic approach:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Prepare</strong>: Assess data quality and standardize column
names</li>
<li>
<strong>Transform</strong>: Apply vecshift() to create temporal
segments with over_id</li>
<li>
<strong>Classify</strong>: Add employment status labels</li>
<li>
<strong>Validate</strong>: Ensure temporal consistency and
classification integrity</li>
<li>
<strong>Analyze</strong>: Extract insights from employment
patterns</li>
<li>
<strong>Extend</strong>: Apply advanced features as needed</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="preparing-your-data">1. Preparing Your Data<a class="anchor" aria-label="anchor" href="#preparing-your-data"></a>
</h2>
<p>Let’s start by creating realistic employment data that includes
common patterns and challenges you might encounter in real-world
datasets.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Create realistic employment data with various patterns -----</span></span>
<span><span class="co"># This dataset represents 10 persons with 60 employment records over 2023</span></span>
<span><span class="va">employment_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">60</span>,</span>
<span>  cf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="co"># Person 001: Stable employment with one gap</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"PERSON001"</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>    <span class="co"># Person 002: Multiple overlapping contracts</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"PERSON002"</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>    <span class="co"># Person 003: Consecutive contracts, same type</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"PERSON003"</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>    <span class="co"># Person 004: Part-time to full-time transition</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"PERSON004"</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>    <span class="co"># Person 005: Seasonal worker with gaps</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"PERSON005"</span>, <span class="fl">7</span><span class="op">)</span>,</span>
<span>    <span class="co"># Person 006: Single long contract</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"PERSON006"</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>    <span class="co"># Person 007: Multiple short contracts</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"PERSON007"</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>    <span class="co"># Person 008: Overlapping with gap</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"PERSON008"</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>    <span class="co"># Person 009: Consecutive with different types</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"PERSON009"</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>    <span class="co"># Person 010: Mixed patterns</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"PERSON010"</span>, <span class="fl">6</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  inizio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="co"># PERSON001</span></span>
<span>    <span class="st">"2023-01-01"</span>, <span class="st">"2023-02-01"</span>, <span class="st">"2023-03-01"</span>, <span class="st">"2023-06-01"</span>, <span class="st">"2023-07-01"</span>, <span class="st">"2023-09-01"</span>,</span>
<span>    <span class="co"># PERSON002</span></span>
<span>    <span class="st">"2023-01-15"</span>, <span class="st">"2023-02-01"</span>, <span class="st">"2023-02-15"</span>, <span class="st">"2023-05-01"</span>, <span class="st">"2023-05-15"</span>, <span class="st">"2023-08-01"</span>, <span class="st">"2023-09-01"</span>, <span class="st">"2023-11-01"</span>,</span>
<span>    <span class="co"># PERSON003</span></span>
<span>    <span class="st">"2023-01-01"</span>, <span class="st">"2023-03-01"</span>, <span class="st">"2023-05-01"</span>, <span class="st">"2023-07-01"</span>, <span class="st">"2023-09-01"</span>,</span>
<span>    <span class="co"># PERSON004</span></span>
<span>    <span class="st">"2023-01-10"</span>, <span class="st">"2023-03-10"</span>, <span class="st">"2023-04-10"</span>, <span class="st">"2023-07-01"</span>, <span class="st">"2023-08-01"</span>, <span class="st">"2023-10-01"</span>,</span>
<span>    <span class="co"># PERSON005</span></span>
<span>    <span class="st">"2023-01-01"</span>, <span class="st">"2023-02-15"</span>, <span class="st">"2023-05-01"</span>, <span class="st">"2023-06-20"</span>, <span class="st">"2023-08-01"</span>, <span class="st">"2023-09-15"</span>, <span class="st">"2023-11-01"</span>,</span>
<span>    <span class="co"># PERSON006</span></span>
<span>    <span class="st">"2023-01-01"</span>, <span class="st">"2023-03-01"</span>, <span class="st">"2023-07-01"</span>,</span>
<span>    <span class="co"># PERSON007</span></span>
<span>    <span class="st">"2023-01-05"</span>, <span class="st">"2023-02-01"</span>, <span class="st">"2023-03-05"</span>, <span class="st">"2023-04-10"</span>, <span class="st">"2023-06-01"</span>, <span class="st">"2023-07-15"</span>, <span class="st">"2023-09-01"</span>, <span class="st">"2023-11-01"</span>,</span>
<span>    <span class="co"># PERSON008</span></span>
<span>    <span class="st">"2023-01-01"</span>, <span class="st">"2023-02-15"</span>, <span class="st">"2023-03-01"</span>, <span class="st">"2023-06-01"</span>, <span class="st">"2023-08-01"</span>, <span class="st">"2023-10-01"</span>,</span>
<span>    <span class="co"># PERSON009</span></span>
<span>    <span class="st">"2023-01-01"</span>, <span class="st">"2023-04-01"</span>, <span class="st">"2023-06-01"</span>, <span class="st">"2023-08-01"</span>, <span class="st">"2023-11-01"</span>,</span>
<span>    <span class="co"># PERSON010</span></span>
<span>    <span class="st">"2023-01-15"</span>, <span class="st">"2023-03-01"</span>, <span class="st">"2023-04-15"</span>, <span class="st">"2023-07-01"</span>, <span class="st">"2023-09-01"</span>, <span class="st">"2023-11-15"</span></span>
<span>  <span class="op">)</span><span class="op">)</span>,</span>
<span>  fine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="co"># PERSON001 (gap in April-May)</span></span>
<span>    <span class="st">"2023-01-31"</span>, <span class="st">"2023-02-28"</span>, <span class="st">"2023-03-31"</span>, <span class="st">"2023-06-30"</span>, <span class="st">"2023-08-31"</span>, <span class="st">"2023-12-31"</span>,</span>
<span>    <span class="co"># PERSON002 (overlapping contracts)</span></span>
<span>    <span class="st">"2023-03-31"</span>, <span class="st">"2023-04-30"</span>, <span class="st">"2023-06-30"</span>, <span class="st">"2023-07-31"</span>, <span class="st">"2023-10-31"</span>, <span class="st">"2023-10-31"</span>, <span class="st">"2023-12-31"</span>, <span class="st">"2023-12-31"</span>,</span>
<span>    <span class="co"># PERSON003 (consecutive, no gaps)</span></span>
<span>    <span class="st">"2023-02-28"</span>, <span class="st">"2023-04-30"</span>, <span class="st">"2023-06-30"</span>, <span class="st">"2023-08-31"</span>, <span class="st">"2023-12-31"</span>,</span>
<span>    <span class="co"># PERSON004 (PT to FT transition)</span></span>
<span>    <span class="st">"2023-02-28"</span>, <span class="st">"2023-03-31"</span>, <span class="st">"2023-06-30"</span>, <span class="st">"2023-07-31"</span>, <span class="st">"2023-09-30"</span>, <span class="st">"2023-12-31"</span>,</span>
<span>    <span class="co"># PERSON005 (seasonal with gaps)</span></span>
<span>    <span class="st">"2023-01-31"</span>, <span class="st">"2023-03-31"</span>, <span class="st">"2023-05-31"</span>, <span class="st">"2023-07-31"</span>, <span class="st">"2023-08-31"</span>, <span class="st">"2023-10-31"</span>, <span class="st">"2023-12-31"</span>,</span>
<span>    <span class="co"># PERSON006 (long stable contract)</span></span>
<span>    <span class="st">"2023-02-28"</span>, <span class="st">"2023-06-30"</span>, <span class="st">"2023-12-31"</span>,</span>
<span>    <span class="co"># PERSON007 (many short contracts)</span></span>
<span>    <span class="st">"2023-01-31"</span>, <span class="st">"2023-02-28"</span>, <span class="st">"2023-04-04"</span>, <span class="st">"2023-05-31"</span>, <span class="st">"2023-07-14"</span>, <span class="st">"2023-08-31"</span>, <span class="st">"2023-10-31"</span>, <span class="st">"2023-12-31"</span>,</span>
<span>    <span class="co"># PERSON008 (overlapping then gap)</span></span>
<span>    <span class="st">"2023-03-31"</span>, <span class="st">"2023-03-31"</span>, <span class="st">"2023-04-30"</span>, <span class="st">"2023-07-31"</span>, <span class="st">"2023-09-30"</span>, <span class="st">"2023-12-31"</span>,</span>
<span>    <span class="co"># PERSON009 (consecutive, varied types)</span></span>
<span>    <span class="st">"2023-03-31"</span>, <span class="st">"2023-05-31"</span>, <span class="st">"2023-07-31"</span>, <span class="st">"2023-10-31"</span>, <span class="st">"2023-12-31"</span>,</span>
<span>    <span class="co"># PERSON010 (mixed)</span></span>
<span>    <span class="st">"2023-02-28"</span>, <span class="st">"2023-04-14"</span>, <span class="st">"2023-06-30"</span>, <span class="st">"2023-08-31"</span>, <span class="st">"2023-11-14"</span>, <span class="st">"2023-12-31"</span></span>
<span>  <span class="op">)</span><span class="op">)</span>,</span>
<span>  prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="co"># PERSON001 (stable full-time)</span></span>
<span>    <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>,</span>
<span>    <span class="co"># PERSON002 (mixed FT and PT, overlapping)</span></span>
<span>    <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>,</span>
<span>    <span class="co"># PERSON003 (consecutive PT)</span></span>
<span>    <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>    <span class="co"># PERSON004 (PT to FT transition)</span></span>
<span>    <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>,</span>
<span>    <span class="co"># PERSON005 (seasonal PT)</span></span>
<span>    <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>    <span class="co"># PERSON006 (stable FT)</span></span>
<span>    <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>,</span>
<span>    <span class="co"># PERSON007 (varied short contracts)</span></span>
<span>    <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>,</span>
<span>    <span class="co"># PERSON008 (overlapping FT)</span></span>
<span>    <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>,</span>
<span>    <span class="co"># PERSON009 (alternating FT/PT)</span></span>
<span>    <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>,</span>
<span>    <span class="co"># PERSON010 (mixed)</span></span>
<span>    <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Created employment dataset with:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Created employment dataset with:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Total records:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">employment_raw</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Total records: 60</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Unique persons:"</span>, <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/duplicated.html" class="external-link">uniqueN</a></span><span class="op">(</span><span class="va">employment_raw</span><span class="op">$</span><span class="va">cf</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Unique persons: 10</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Date range:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">employment_raw</span><span class="op">$</span><span class="va">inizio</span><span class="op">)</span>, <span class="st">"%Y-%m-%d"</span><span class="op">)</span>,</span>
<span>    <span class="st">"to"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">employment_raw</span><span class="op">$</span><span class="va">fine</span><span class="op">)</span>, <span class="st">"%Y-%m-%d"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Date range: 2023-01-01 to 2023-12-31</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Full-time contracts:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">employment_raw</span><span class="op">$</span><span class="va">prior</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Full-time contracts: 32</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Part-time contracts:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">employment_raw</span><span class="op">$</span><span class="va">prior</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Part-time contracts: 28</span></span></code></pre></div>
<div class="section level3">
<h3 id="initial-data-overview">Initial Data Overview<a class="anchor" aria-label="anchor" href="#initial-data-overview"></a>
</h3>
<p>Before processing, let’s examine a sample of the data to understand
its structure:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View sample records from different persons</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Sample records from PERSON001 (stable employment with gap):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sample records from PERSON001 (stable employment with gap):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">employment_raw</span><span class="op">[</span><span class="va">cf</span> <span class="op">==</span> <span class="st">"PERSON001"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;       id        cf     inizio       fine prior</span></span>
<span><span class="co">#&gt;    &lt;int&gt;    &lt;char&gt;     &lt;Date&gt;     &lt;Date&gt; &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     1 PERSON001 2023-01-01 2023-01-31     1</span></span>
<span><span class="co">#&gt; 2:     2 PERSON001 2023-02-01 2023-02-28     1</span></span>
<span><span class="co">#&gt; 3:     3 PERSON001 2023-03-01 2023-03-31     1</span></span>
<span><span class="co">#&gt; 4:     4 PERSON001 2023-06-01 2023-06-30     1</span></span>
<span><span class="co">#&gt; 5:     5 PERSON001 2023-07-01 2023-08-31     1</span></span>
<span><span class="co">#&gt; 6:     6 PERSON001 2023-09-01 2023-12-31     1</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nSample records from PERSON002 (overlapping contracts):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Sample records from PERSON002 (overlapping contracts):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">employment_raw</span><span class="op">[</span><span class="va">cf</span> <span class="op">==</span> <span class="st">"PERSON002"</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;       id        cf     inizio       fine prior</span></span>
<span><span class="co">#&gt;    &lt;int&gt;    &lt;char&gt;     &lt;Date&gt;     &lt;Date&gt; &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     7 PERSON002 2023-01-15 2023-03-31     1</span></span>
<span><span class="co">#&gt; 2:     8 PERSON002 2023-02-01 2023-04-30     0</span></span>
<span><span class="co">#&gt; 3:     9 PERSON002 2023-02-15 2023-06-30     1</span></span>
<span><span class="co">#&gt; 4:    10 PERSON002 2023-05-01 2023-07-31     0</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nSample records from PERSON004 (PT to FT transition):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Sample records from PERSON004 (PT to FT transition):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">employment_raw</span><span class="op">[</span><span class="va">cf</span> <span class="op">==</span> <span class="st">"PERSON004"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;       id        cf     inizio       fine prior</span></span>
<span><span class="co">#&gt;    &lt;int&gt;    &lt;char&gt;     &lt;Date&gt;     &lt;Date&gt; &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:    20 PERSON004 2023-01-10 2023-02-28     0</span></span>
<span><span class="co">#&gt; 2:    21 PERSON004 2023-03-10 2023-03-31     0</span></span>
<span><span class="co">#&gt; 3:    22 PERSON004 2023-04-10 2023-06-30     0</span></span>
<span><span class="co">#&gt; 4:    23 PERSON004 2023-07-01 2023-07-31     1</span></span>
<span><span class="co">#&gt; 5:    24 PERSON004 2023-08-01 2023-09-30     1</span></span>
<span><span class="co">#&gt; 6:    25 PERSON004 2023-10-01 2023-12-31     1</span></span>
<span></span>
<span><span class="co"># Calculate basic statistics</span></span>
<span><span class="va">employment_raw</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span></span>
<span>  contracts <span class="op">=</span> <span class="va">.N</span>,</span>
<span>  first_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">inizio</span><span class="op">)</span>,</span>
<span>  last_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">fine</span><span class="op">)</span>,</span>
<span>  total_contract_days <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">fine</span> <span class="op">-</span> <span class="va">inizio</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span>, by <span class="op">=</span> <span class="va">cf</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;           cf contracts first_date  last_date total_contract_days</span></span>
<span><span class="co">#&gt;       &lt;char&gt;     &lt;int&gt;     &lt;Date&gt;     &lt;Date&gt;               &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: PERSON001         6 2023-01-01 2023-12-31                 304</span></span>
<span><span class="co">#&gt; 2: PERSON002         8 2023-01-15 2023-12-31                 838</span></span>
<span><span class="co">#&gt; 3: PERSON003         5 2023-01-01 2023-12-31                 365</span></span>
<span><span class="co">#&gt; 4: PERSON004         6 2023-01-10 2023-12-31                 338</span></span>
<span><span class="co">#&gt; 5: PERSON005         7 2023-01-01 2023-12-31                 288</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="data-quality-assessment">2. Data Quality Assessment<a class="anchor" aria-label="anchor" href="#data-quality-assessment"></a>
</h2>
<p>Before processing employment data, it is essential to assess data
quality. The vecshift package provides comprehensive quality assessment
tools.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 2. Assess data quality -----</span></span>
<span><span class="va">quality_report</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assess_data_quality.html">assess_data_quality</a></span><span class="op">(</span><span class="va">employment_raw</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Data Quality Assessment:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Data Quality Assessment:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"========================\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ========================</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Basic Validation:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Basic Validation:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Valid person IDs:"</span>, <span class="va">quality_report</span><span class="op">$</span><span class="va">basic_checks</span><span class="op">$</span><span class="va">valid_person_ids</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Valid person IDs:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Valid dates:"</span>, <span class="va">quality_report</span><span class="op">$</span><span class="va">basic_checks</span><span class="op">$</span><span class="va">valid_dates</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Valid dates:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Valid date ranges:"</span>, <span class="va">quality_report</span><span class="op">$</span><span class="va">basic_checks</span><span class="op">$</span><span class="va">valid_date_ranges</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Valid date ranges:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Has duplicates:"</span>, <span class="va">quality_report</span><span class="op">$</span><span class="va">basic_checks</span><span class="op">$</span><span class="va">has_duplicates</span>, <span class="st">"\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Has duplicates:</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Date Issues:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Date Issues:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Invalid ranges:"</span>, <span class="va">quality_report</span><span class="op">$</span><span class="va">date_issues</span><span class="op">$</span><span class="va">n_invalid_ranges</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Invalid ranges:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Missing start dates:"</span>, <span class="va">quality_report</span><span class="op">$</span><span class="va">date_issues</span><span class="op">$</span><span class="va">n_missing_inizio</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Missing start dates:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Missing end dates:"</span>, <span class="va">quality_report</span><span class="op">$</span><span class="va">date_issues</span><span class="op">$</span><span class="va">n_missing_fine</span>, <span class="st">"\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Missing end dates:</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Temporal Coverage:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Temporal Coverage:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Total persons:"</span>, <span class="va">quality_report</span><span class="op">$</span><span class="va">temporal_coverage</span><span class="op">$</span><span class="va">n_persons</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Total persons:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Total contracts:"</span>, <span class="va">quality_report</span><span class="op">$</span><span class="va">temporal_coverage</span><span class="op">$</span><span class="va">n_contracts</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Total contracts:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Date range:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">quality_report</span><span class="op">$</span><span class="va">temporal_coverage</span><span class="op">$</span><span class="va">date_range_start</span><span class="op">)</span>,</span>
<span>    <span class="st">"to"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">quality_report</span><span class="op">$</span><span class="va">temporal_coverage</span><span class="op">$</span><span class="va">date_range_end</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Date range: NULL to NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Span (days):"</span>, <span class="va">quality_report</span><span class="op">$</span><span class="va">temporal_coverage</span><span class="op">$</span><span class="va">total_days_span</span>, <span class="st">"\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Span (days):</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Quality Score:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Quality Score:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Overall score:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">quality_report</span><span class="op">$</span><span class="va">quality_score</span><span class="op">$</span><span class="va">overall_score</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Overall score: 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Production ready:"</span>, <span class="va">quality_report</span><span class="op">$</span><span class="va">quality_score</span><span class="op">$</span><span class="va">is_production_ready</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Production ready: TRUE</span></span></code></pre></div>
<p>The quality assessment confirms our data is clean and ready for
processing. In real scenarios, you might encounter issues that need
cleaning.</p>
</div>
<div class="section level2">
<h2 id="standardizing-column-names">3. Standardizing Column Names<a class="anchor" aria-label="anchor" href="#standardizing-column-names"></a>
</h2>
<p>If your data uses different column names, use the standardization
function to map them to vecshift’s expected format:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 3. Standardize column names (example with custom names) -----</span></span>
<span><span class="co"># This example shows how to handle data with non-standard column names</span></span>
<span></span>
<span><span class="co"># Suppose your data has these column names:</span></span>
<span><span class="va">custom_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>  contract_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>  person_code <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A001"</span>, <span class="st">"A001"</span>, <span class="st">"B002"</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2023-01-01"</span>, <span class="st">"2023-06-01"</span>, <span class="st">"2023-02-01"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2023-05-31"</span>, <span class="st">"2023-12-31"</span>, <span class="st">"2023-11-30"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  employment_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define the mapping</span></span>
<span><span class="va">column_mapping</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">"contract_id"</span>,</span>
<span>  cf <span class="op">=</span> <span class="st">"person_code"</span>,</span>
<span>  inizio <span class="op">=</span> <span class="st">"start_date"</span>,</span>
<span>  fine <span class="op">=</span> <span class="st">"end_date"</span>,</span>
<span>  prior <span class="op">=</span> <span class="st">"employment_type"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Standardize the columns</span></span>
<span><span class="va">standardized_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/standardize_columns.html">standardize_columns</a></span><span class="op">(</span><span class="va">custom_data</span>, <span class="va">column_mapping</span>, validate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Columns standardized from custom names to vecshift format\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">standardized_data</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Our dataset already uses standard column names, so we can proceed
directly to the transformation step.</p>
</div>
<div class="section level2">
<h2 id="core-transformation-with-vecshift">4. Core Transformation with vecshift()<a class="anchor" aria-label="anchor" href="#core-transformation-with-vecshift"></a>
</h2>
<p>Now we apply the main vecshift transformation, which converts
employment contracts into continuous temporal segments with overlap
detection and consolidation identifiers.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 4. Apply vecshift transformation -----</span></span>
<span><span class="va">processed_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vecshift.html">vecshift</a></span><span class="op">(</span><span class="va">employment_raw</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Transformation complete!\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Transformation complete!</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"========================\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ========================</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Input records:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">employment_raw</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Input records: 60</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Output segments:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">processed_data</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Output segments: 76</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Expansion factor:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">processed_data</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">employment_raw</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"x\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Expansion factor: 1.27 x</span></span>
<span></span>
<span><span class="co"># Examine the output structure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Output columns:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Output columns:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">processed_data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "cf"      "inizio"  "fine"    "arco"    "prior"   "id"      "over_id"</span></span>
<span><span class="co">#&gt; [8] "durata"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n\nSample output for PERSON001:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Sample output for PERSON001:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">processed_data</span><span class="op">[</span><span class="va">cf</span> <span class="op">==</span> <span class="st">"PERSON001"</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;            cf     inizio       fine  arco prior    id over_id     durata</span></span>
<span><span class="co">#&gt;        &lt;char&gt;     &lt;Date&gt;     &lt;Date&gt; &lt;num&gt; &lt;num&gt; &lt;int&gt;   &lt;int&gt; &lt;difftime&gt;</span></span>
<span><span class="co">#&gt;  1: PERSON001 2023-01-01 2023-01-31     1     1     1       1    31 days</span></span>
<span><span class="co">#&gt;  2: PERSON001 2023-02-01 2023-02-28     1     1     2       2    28 days</span></span>
<span><span class="co">#&gt;  3: PERSON001 2023-03-01 2023-03-31     1     1     3       3    31 days</span></span>
<span><span class="co">#&gt;  4: PERSON001 2023-04-01 2023-05-31     0     0     0       0    61 days</span></span>
<span><span class="co">#&gt;  5: PERSON001 2023-06-01 2023-06-30     1     1     4       4    30 days</span></span>
<span><span class="co">#&gt;  6: PERSON001 2023-07-01 2023-08-31     1     1     5       5    62 days</span></span>
<span><span class="co">#&gt;  7: PERSON001 2023-09-01 2023-12-31     1     1     6       6   122 days</span></span>
<span><span class="co">#&gt;  8:      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;    NA    NA    NA      NA    NA days</span></span>
<span><span class="co">#&gt;  9:      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;    NA    NA    NA      NA    NA days</span></span>
<span><span class="co">#&gt; 10:      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;    NA    NA    NA      NA    NA days</span></span></code></pre></div>
<div class="section level3">
<h3 id="understanding-the-key-columns">Understanding the Key Columns<a class="anchor" aria-label="anchor" href="#understanding-the-key-columns"></a>
</h3>
<p>Let’s explore what each column represents:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Key Column Meanings:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key Column Meanings:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"===================\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===================</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"over_id: Consolidation identifier for continuous overlapping employment\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; over_id: Consolidation identifier for continuous overlapping employment</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  - over_id = 0: Unemployment periods\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   - over_id = 0: Unemployment periods</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  - over_id &gt; 0: Employment periods (same value = continuous overlapping employment)\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   - over_id &gt; 0: Employment periods (same value = continuous overlapping employment)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"arco: Number of overlapping contracts at this point in time\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; arco: Number of overlapping contracts at this point in time</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  - arco = 0: Unemployed\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   - arco = 0: Unemployed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  - arco = 1: Single employment\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   - arco = 1: Single employment</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  - arco &gt; 1: Multiple simultaneous employments\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   - arco &gt; 1: Multiple simultaneous employments</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"durata: Duration of this segment in days (corrected for temporal consistency)\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; durata: Duration of this segment in days (corrected for temporal consistency)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"prior: Employment type indicator from original data\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; prior: Employment type indicator from original data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  - 0 or -1: Part-time\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   - 0 or -1: Part-time</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  - 1: Full-time\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   - 1: Full-time</span></span>
<span></span>
<span><span class="co"># Show examples of each employment state</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Example: Unemployment period (arco = 0, over_id = 0):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Example: Unemployment period (arco = 0, over_id = 0):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">processed_data</span><span class="op">[</span><span class="va">arco</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">cf</span> <span class="op">==</span> <span class="st">"PERSON001"</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;           cf     inizio       fine  arco prior    id over_id     durata</span></span>
<span><span class="co">#&gt;       &lt;char&gt;     &lt;Date&gt;     &lt;Date&gt; &lt;num&gt; &lt;num&gt; &lt;int&gt;   &lt;int&gt; &lt;difftime&gt;</span></span>
<span><span class="co">#&gt; 1: PERSON001 2023-04-01 2023-05-31     0     0     0       0    61 days</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nExample: Single employment (arco = 1, over_id &gt; 0):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Example: Single employment (arco = 1, over_id &gt; 0):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">processed_data</span><span class="op">[</span><span class="va">arco</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">cf</span> <span class="op">==</span> <span class="st">"PERSON001"</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;           cf     inizio       fine  arco prior    id over_id     durata</span></span>
<span><span class="co">#&gt;       &lt;char&gt;     &lt;Date&gt;     &lt;Date&gt; &lt;num&gt; &lt;num&gt; &lt;int&gt;   &lt;int&gt; &lt;difftime&gt;</span></span>
<span><span class="co">#&gt; 1: PERSON001 2023-01-01 2023-01-31     1     1     1       1    31 days</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nExample: Overlapping employment (arco &gt; 1, over_id &gt; 0):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Example: Overlapping employment (arco &gt; 1, over_id &gt; 0):</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">processed_data</span><span class="op">[</span><span class="va">arco</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">processed_data</span><span class="op">[</span><span class="va">arco</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"No overlapping employment in this dataset\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt;           cf     inizio       fine  arco prior    id over_id     durata</span></span>
<span><span class="co">#&gt;       &lt;char&gt;     &lt;Date&gt;     &lt;Date&gt; &lt;num&gt; &lt;num&gt; &lt;int&gt;   &lt;int&gt; &lt;difftime&gt;</span></span>
<span><span class="co">#&gt; 1: PERSON002 2023-02-01 2023-02-15     2     0     8       7    14 days</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="key-metrics-by-person">Key Metrics by Person<a class="anchor" aria-label="anchor" href="#key-metrics-by-person"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate key metrics for each person</span></span>
<span><span class="va">person_metrics</span> <span class="op">&lt;-</span> <span class="va">processed_data</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span></span>
<span>  total_segments <span class="op">=</span> <span class="va">.N</span>,</span>
<span>  employment_segments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">arco</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>  unemployment_segments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">arco</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>  overlapping_segments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">arco</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  total_days <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">durata</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  employment_days <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">durata</span><span class="op">[</span><span class="va">arco</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  employment_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">durata</span><span class="op">[</span><span class="va">arco</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">durata</span><span class="op">)</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  unique_over_ids <span class="op">=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/duplicated.html" class="external-link">uniqueN</a></span><span class="op">(</span><span class="va">over_id</span><span class="op">[</span><span class="va">over_id</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span>, by <span class="op">=</span> <span class="va">cf</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Employment Metrics by Person:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Employment Metrics by Person:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">person_metrics</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;            cf total_segments employment_segments unemployment_segments</span></span>
<span><span class="co">#&gt;        &lt;char&gt;          &lt;int&gt;               &lt;int&gt;                 &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1: PERSON001              7                   6                     1</span></span>
<span><span class="co">#&gt;  2: PERSON002             13                  13                     0</span></span>
<span><span class="co">#&gt;  3: PERSON003              5                   5                     0</span></span>
<span><span class="co">#&gt;  4: PERSON004              8                   6                     2</span></span>
<span><span class="co">#&gt;  5: PERSON005             11                   7                     4</span></span>
<span><span class="co">#&gt;  6: PERSON006              3                   3                     0</span></span>
<span><span class="co">#&gt;  7: PERSON007             10                   8                     2</span></span>
<span><span class="co">#&gt;  8: PERSON008              8                   7                     1</span></span>
<span><span class="co">#&gt;  9: PERSON009              5                   5                     0</span></span>
<span><span class="co">#&gt; 10: PERSON010              6                   6                     0</span></span>
<span><span class="co">#&gt;     overlapping_segments total_days employment_days employment_rate</span></span>
<span><span class="co">#&gt;                    &lt;int&gt;      &lt;num&gt;           &lt;num&gt;           &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:                    0        365             304           0.833</span></span>
<span><span class="co">#&gt;  2:                    9        351             351           1.000</span></span>
<span><span class="co">#&gt;  3:                    0        365             365           1.000</span></span>
<span><span class="co">#&gt;  4:                    0        356             338           0.949</span></span>
<span><span class="co">#&gt;  5:                    0        365             288           0.789</span></span>
<span><span class="co">#&gt;  6:                    0        365             365           1.000</span></span>
<span><span class="co">#&gt;  7:                    0        361             352           0.975</span></span>
<span><span class="co">#&gt;  8:                    2        365             334           0.915</span></span>
<span><span class="co">#&gt;  9:                    0        365             365           1.000</span></span>
<span><span class="co">#&gt; 10:                    0        351             351           1.000</span></span>
<span><span class="co">#&gt;     unique_over_ids</span></span>
<span><span class="co">#&gt;               &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1:               6</span></span>
<span><span class="co">#&gt;  2:               1</span></span>
<span><span class="co">#&gt;  3:               5</span></span>
<span><span class="co">#&gt;  4:               6</span></span>
<span><span class="co">#&gt;  5:               7</span></span>
<span><span class="co">#&gt;  6:               3</span></span>
<span><span class="co">#&gt;  7:               8</span></span>
<span><span class="co">#&gt;  8:               4</span></span>
<span><span class="co">#&gt;  9:               5</span></span>
<span><span class="co">#&gt; 10:               6</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n\nSummary Statistics:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Summary Statistics:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Average employment rate:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">person_metrics</span><span class="op">$</span><span class="va">employment_rate</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Average employment rate: 0.946</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Persons with overlapping employment:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">person_metrics</span><span class="op">$</span><span class="va">overlapping_segments</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Persons with overlapping employment: 2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Persons with unemployment gaps:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">person_metrics</span><span class="op">$</span><span class="va">unemployment_segments</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Persons with unemployment gaps: 5</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="employment-status-classification">5. Employment Status Classification<a class="anchor" aria-label="anchor" href="#employment-status-classification"></a>
</h2>
<p>The vecshift package includes a flexible status classification system
that labels employment segments based on employment type and overlap
patterns.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 5. Apply employment status classification -----</span></span>
<span><span class="va">classified_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/classify_employment_status.html">classify_employment_status</a></span><span class="op">(</span></span>
<span>  <span class="va">processed_data</span>,</span>
<span>  group_by <span class="op">=</span> <span class="st">"cf"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Status Classification Complete!\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Status Classification Complete!</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"================================\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ================================</span></span>
<span></span>
<span><span class="co"># View status distribution</span></span>
<span><span class="va">status_counts</span> <span class="op">&lt;-</span> <span class="va">classified_data</span><span class="op">[</span>, <span class="va">.N</span>, by <span class="op">=</span> <span class="va">stato</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">N</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Status Distribution:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Status Distribution:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">status_counts</span><span class="op">)</span></span>
<span><span class="co">#&gt;          stato     N</span></span>
<span><span class="co">#&gt;         &lt;char&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:          pt    29</span></span>
<span><span class="co">#&gt; 2:          ft    28</span></span>
<span><span class="co">#&gt; 3: disoccupato    10</span></span>
<span><span class="co">#&gt; 4:       pt_ft     9</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n\nStatus meanings:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Status meanings:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- disoccupato: Unemployed\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - disoccupato: Unemployed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- occ_ft: Employed full-time (single contract)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - occ_ft: Employed full-time (single contract)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- occ_pt: Employed part-time (single contract)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - occ_pt: Employed part-time (single contract)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- over_*: Overlapping employment with specific patterns\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - over_*: Overlapping employment with specific patterns</span></span>
<span></span>
<span><span class="co"># Show examples with status labels</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n\nSample records with status labels (PERSON004 - PT to FT transition):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Sample records with status labels (PERSON004 - PT to FT transition):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">classified_data</span><span class="op">[</span><span class="va">cf</span> <span class="op">==</span> <span class="st">"PERSON004"</span>, <span class="fu">.</span><span class="op">(</span><span class="va">cf</span>, <span class="va">inizio</span>, <span class="va">fine</span>, <span class="va">arco</span>, <span class="va">prior</span>, <span class="va">stato</span>, <span class="va">durata</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;           cf     inizio       fine  arco prior       stato     durata</span></span>
<span><span class="co">#&gt;       &lt;char&gt;     &lt;Date&gt;     &lt;Date&gt; &lt;num&gt; &lt;num&gt;      &lt;char&gt; &lt;difftime&gt;</span></span>
<span><span class="co">#&gt; 1: PERSON004 2023-01-10 2023-02-28     1     0          pt    50 days</span></span>
<span><span class="co">#&gt; 2: PERSON004 2023-03-01 2023-03-09     0     0 disoccupato     9 days</span></span>
<span><span class="co">#&gt; 3: PERSON004 2023-03-10 2023-03-31     1     0          pt    22 days</span></span>
<span><span class="co">#&gt; 4: PERSON004 2023-04-01 2023-04-09     0     0 disoccupato     9 days</span></span>
<span><span class="co">#&gt; 5: PERSON004 2023-04-10 2023-06-30     1     0          pt    82 days</span></span>
<span><span class="co">#&gt; 6: PERSON004 2023-07-01 2023-07-31     1     1          ft    31 days</span></span>
<span><span class="co">#&gt; 7: PERSON004 2023-08-01 2023-09-30     1     1          ft    61 days</span></span>
<span><span class="co">#&gt; 8: PERSON004 2023-10-01 2023-12-31     1     1          ft    92 days</span></span></code></pre></div>
<div class="section level3">
<h3 id="employment-vs-unemployment-analysis">Employment vs Unemployment Analysis<a class="anchor" aria-label="anchor" href="#employment-vs-unemployment-analysis"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate employment statistics by status</span></span>
<span><span class="va">employment_stats</span> <span class="op">&lt;-</span> <span class="va">classified_data</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span></span>
<span>  total_duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">durata</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  avg_segment_duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">durata</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  min_duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">durata</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  max_duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">durata</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  n_segments <span class="op">=</span> <span class="va">.N</span></span>
<span><span class="op">)</span>, by <span class="op">=</span> <span class="va">stato</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">total_duration</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Duration Statistics by Status:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Duration Statistics by Status:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">employment_stats</span><span class="op">)</span></span>
<span><span class="co">#&gt;          stato total_duration avg_segment_duration min_duration max_duration</span></span>
<span><span class="co">#&gt;         &lt;char&gt;          &lt;num&gt;                &lt;num&gt;        &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:          ft           1681                 60.0           14          184</span></span>
<span><span class="co">#&gt; 2:          pt           1402                 48.3            1          122</span></span>
<span><span class="co">#&gt; 3:       pt_ft            330                 36.7           14           60</span></span>
<span><span class="co">#&gt; 4: disoccupato            196                 19.6            4           61</span></span>
<span><span class="co">#&gt;    n_segments</span></span>
<span><span class="co">#&gt;         &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:         28</span></span>
<span><span class="co">#&gt; 2:         29</span></span>
<span><span class="co">#&gt; 3:          9</span></span>
<span><span class="co">#&gt; 4:         10</span></span>
<span></span>
<span><span class="co"># Calculate person-level employment metrics</span></span>
<span><span class="va">person_employment</span> <span class="op">&lt;-</span> <span class="va">classified_data</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span></span>
<span>  total_days <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">durata</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  employment_days <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">durata</span><span class="op">[</span><span class="va">stato</span> <span class="op">!=</span> <span class="st">"disoccupato"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  unemployment_days <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">durata</span><span class="op">[</span><span class="va">stato</span> <span class="op">==</span> <span class="st">"disoccupato"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  employment_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">durata</span><span class="op">[</span><span class="va">stato</span> <span class="op">!=</span> <span class="st">"disoccupato"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">durata</span><span class="op">)</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  primary_status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">stato</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span>, by <span class="op">=</span> <span class="va">cf</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n\nPerson-Level Employment Summary:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Person-Level Employment Summary:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">person_employment</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;            cf total_days employment_days unemployment_days employment_rate</span></span>
<span><span class="co">#&gt;        &lt;char&gt;      &lt;num&gt;           &lt;num&gt;             &lt;num&gt;           &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1: PERSON001        365             304                61           0.833</span></span>
<span><span class="co">#&gt;  2: PERSON002        351             351                 0           1.000</span></span>
<span><span class="co">#&gt;  3: PERSON003        365             365                 0           1.000</span></span>
<span><span class="co">#&gt;  4: PERSON004        356             338                18           0.949</span></span>
<span><span class="co">#&gt;  5: PERSON005        365             288                77           0.789</span></span>
<span><span class="co">#&gt;  6: PERSON006        365             365                 0           1.000</span></span>
<span><span class="co">#&gt;  7: PERSON007        361             352                 9           0.975</span></span>
<span><span class="co">#&gt;  8: PERSON008        365             334                31           0.915</span></span>
<span><span class="co">#&gt;  9: PERSON009        365             365                 0           1.000</span></span>
<span><span class="co">#&gt; 10: PERSON010        351             351                 0           1.000</span></span>
<span><span class="co">#&gt;     primary_status</span></span>
<span><span class="co">#&gt;             &lt;char&gt;</span></span>
<span><span class="co">#&gt;  1:             ft</span></span>
<span><span class="co">#&gt;  2:          pt_ft</span></span>
<span><span class="co">#&gt;  3:             pt</span></span>
<span><span class="co">#&gt;  4:             ft</span></span>
<span><span class="co">#&gt;  5:             pt</span></span>
<span><span class="co">#&gt;  6:             ft</span></span>
<span><span class="co">#&gt;  7:             pt</span></span>
<span><span class="co">#&gt;  8:             ft</span></span>
<span><span class="co">#&gt;  9:             ft</span></span>
<span><span class="co">#&gt; 10:             ft</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n\nOverall Statistics:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall Statistics:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Average employment rate:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">person_employment</span><span class="op">$</span><span class="va">employment_rate</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Average employment rate: 0.946</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Median employment rate:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">person_employment</span><span class="op">$</span><span class="va">employment_rate</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Median employment rate: 0.988</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Fully employed persons (rate = 1.0):"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">person_employment</span><span class="op">$</span><span class="va">employment_rate</span> <span class="op">==</span> <span class="fl">1.0</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Fully employed persons (rate = 1.0): 5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Persons with unemployment gaps:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">person_employment</span><span class="op">$</span><span class="va">unemployment_days</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Persons with unemployment gaps: 5</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="quality-validation">6. Quality Validation<a class="anchor" aria-label="anchor" href="#quality-validation"></a>
</h2>
<p>After classification, validate the integrity of the results to ensure
temporal consistency and proper classification.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 6. Validate status classifications -----</span></span>
<span><span class="va">validation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/validate_status_classifications.html">validate_status_classifications</a></span><span class="op">(</span><span class="va">classified_data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Classification Validation Results:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Classification Validation Results:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"===================================\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ===================================</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Overall validation:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">validation</span><span class="op">$</span><span class="va">is_valid</span>, <span class="st">"PASSED"</span>, <span class="st">"FAILED"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Overall validation: FAILED</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Total segments:"</span>, <span class="va">validation</span><span class="op">$</span><span class="va">total_segments</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Total segments:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Missing labels:"</span>, <span class="va">validation</span><span class="op">$</span><span class="va">missing_labels</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Missing labels: 0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Invalid labels:"</span>, <span class="va">validation</span><span class="op">$</span><span class="va">invalid_labels</span>, <span class="st">"\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Invalid labels:</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">validation</span><span class="op">$</span><span class="va">total_impossible</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Impossible combinations detected:"</span>, <span class="va">validation</span><span class="op">$</span><span class="va">total_impossible</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Details:\n"</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">issue</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">validation</span><span class="op">$</span><span class="va">impossible_combinations</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">count</span> <span class="op">&lt;-</span> <span class="va">validation</span><span class="op">$</span><span class="va">impossible_combinations</span><span class="op">[[</span><span class="va">issue</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">count</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  -"</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">" "</span>, <span class="va">issue</span><span class="op">)</span>, <span class="st">":"</span>, <span class="va">count</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"No impossible combinations detected - classification is consistent!\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; No impossible combinations detected - classification is consistent!</span></span>
<span></span>
<span><span class="co"># Verify temporal continuity for a sample person</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n\nTemporal Continuity Check (PERSON001):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Temporal Continuity Check (PERSON001):</span></span>
<span><span class="va">person_segments</span> <span class="op">&lt;-</span> <span class="va">classified_data</span><span class="op">[</span><span class="va">cf</span> <span class="op">==</span> <span class="st">"PERSON001"</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">inizio</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">person_segments</span><span class="op">[</span>, <span class="va">gap_before</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">.I</span> <span class="op">&gt;</span> <span class="fl">1</span>,</span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">inizio</span> <span class="op">-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/shift.html" class="external-link">shift</a></span><span class="op">(</span><span class="va">fine</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                       <span class="cn">NA</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">person_segments</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"All segments continuous:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">person_segments</span><span class="op">$</span><span class="va">gap_before</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">person_segments</span><span class="op">)</span><span class="op">]</span> <span class="op">==</span> <span class="fl">1</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Single segment - no gaps to check\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; All segments continuous: TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="pattern-analysis">7. Pattern Analysis<a class="anchor" aria-label="anchor" href="#pattern-analysis"></a>
</h2>
<p>The package provides tools to analyze employment patterns, including
status transitions and duration distributions.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 7. Analyze employment status patterns -----</span></span>
<span><span class="va">patterns</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyze_status_patterns.html">analyze_status_patterns</a></span><span class="op">(</span></span>
<span>  <span class="va">classified_data</span>,</span>
<span>  person_col <span class="op">=</span> <span class="st">"cf"</span>,</span>
<span>  include_transitions <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Employment Pattern Analysis:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Employment Pattern Analysis:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"=============================\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; =============================</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Status Distribution:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Status Distribution:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">patterns</span><span class="op">$</span><span class="va">status_distribution</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; disoccupato          ft          pt       pt_ft </span></span>
<span><span class="co">#&gt;          10          28          29           9</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n\nTransition Matrix:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Transition Matrix:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"(Shows transitions from row status to column status)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Shows transitions from row status to column status)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">patterns</span><span class="op">$</span><span class="va">transition_matrix</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n\nAverage Durations by Status:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average Durations by Status:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">patterns</span><span class="op">$</span><span class="va">average_durations</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n\nPattern Summary:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Pattern Summary:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Total unique statuses:"</span>, <span class="va">patterns</span><span class="op">$</span><span class="va">n_unique_statuses</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Total unique statuses:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Total transitions observed:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">patterns</span><span class="op">$</span><span class="va">transition_matrix</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Total transitions observed: 0</span></span>
<span></span>
<span><span class="co"># Most common status (handle both vector and data.frame formats)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="op">(</span><span class="va">patterns</span><span class="op">$</span><span class="va">status_distribution</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Most common status:"</span>, <span class="va">patterns</span><span class="op">$</span><span class="va">status_distribution</span><span class="op">$</span><span class="va">status</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">patterns</span><span class="op">$</span><span class="va">status_distribution</span><span class="op">$</span><span class="va">count</span><span class="op">)</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Most common status:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">patterns</span><span class="op">$</span><span class="va">status_distribution</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; - Most common status: pt</span></span>
<span></span>
<span><span class="co"># Most common transition</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">patterns</span><span class="op">$</span><span class="va">transition_matrix</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">patterns</span><span class="op">$</span><span class="va">transition_matrix</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">trans_mat</span> <span class="op">&lt;-</span> <span class="va">patterns</span><span class="op">$</span><span class="va">transition_matrix</span></span>
<span>  <span class="va">max_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">trans_mat</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">trans_mat</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, arr.ind <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Most common transition:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">trans_mat</span><span class="op">)</span><span class="op">[</span><span class="va">max_idx</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">"-&gt;"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">trans_mat</span><span class="op">)</span><span class="op">[</span><span class="va">max_idx</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level3">
<h3 id="detailed-transition-analysis">Detailed Transition Analysis<a class="anchor" aria-label="anchor" href="#detailed-transition-analysis"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Examine specific transition patterns</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">patterns</span><span class="op">$</span><span class="va">transition_matrix</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nKey Transition Patterns:\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Unemployment to employment transitions</span></span>
<span>  <span class="va">unemp_to_emp</span> <span class="op">&lt;-</span> <span class="va">patterns</span><span class="op">$</span><span class="va">transition_matrix</span><span class="op">[</span><span class="st">"disoccupato"</span>,</span>
<span>                                              <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"^occ_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">patterns</span><span class="op">$</span><span class="va">transition_matrix</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">unemp_to_emp</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"From Unemployment to Employment:\n"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">unemp_to_emp</span><span class="op">[</span><span class="va">unemp_to_emp</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Employment to unemployment transitions</span></span>
<span>  <span class="va">emp_to_unemp</span> <span class="op">&lt;-</span> <span class="va">patterns</span><span class="op">$</span><span class="va">transition_matrix</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"^occ_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">patterns</span><span class="op">$</span><span class="va">transition_matrix</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                                             <span class="st">"disoccupato"</span><span class="op">]</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">emp_to_unemp</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nFrom Employment to Unemployment:\n"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">emp_to_unemp</span><span class="op">[</span><span class="va">emp_to_unemp</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="advanced-features">8. Advanced Features<a class="anchor" aria-label="anchor" href="#advanced-features"></a>
</h2>
<p>The vecshift package provides several advanced capabilities for
specialized analysis scenarios.</p>
<div class="section level3">
<h3 id="adding-external-events">8.1 Adding External Events<a class="anchor" aria-label="anchor" href="#adding-external-events"></a>
</h3>
<p>You can match external events (such as policy changes or economic
shocks) to employment segments to analyze their impact.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 8.1 Adding external events -----</span></span>
<span><span class="co"># Define external events that occurred during 2023</span></span>
<span><span class="co"># Events are matched to unemployment periods in vecshift output</span></span>
<span><span class="va">external_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>  cf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PERSON001"</span>, <span class="st">"PERSON002"</span>, <span class="st">"PERSON005"</span><span class="op">)</span>,</span>
<span>  event_start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2023-04-15"</span>, <span class="st">"2023-03-01"</span>, <span class="st">"2023-04-15"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  event_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"training_program"</span>, <span class="st">"policy_change"</span>, <span class="st">"subsidy_program"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"External Events:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; External Events:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">external_events</span><span class="op">)</span></span>
<span><span class="co">#&gt;           cf event_start       event_name</span></span>
<span><span class="co">#&gt;       &lt;char&gt;      &lt;Date&gt;           &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1: PERSON001  2023-04-15 training_program</span></span>
<span><span class="co">#&gt; 2: PERSON002  2023-03-01    policy_change</span></span>
<span><span class="co">#&gt; 3: PERSON005  2023-04-15  subsidy_program</span></span>
<span></span>
<span><span class="co"># Match events to unemployment periods</span></span>
<span><span class="va">data_with_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_external_events.html">add_external_events</a></span><span class="op">(</span></span>
<span>  vecshift_data <span class="op">=</span> <span class="va">classified_data</span>,</span>
<span>  external_events <span class="op">=</span> <span class="va">external_events</span>,</span>
<span>  event_matching_strategy <span class="op">=</span> <span class="st">"overlap"</span>,</span>
<span>  date_columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>start <span class="op">=</span> <span class="st">"event_start"</span><span class="op">)</span>,</span>
<span>  event_name_column <span class="op">=</span> <span class="st">"event_name"</span>,</span>
<span>  person_id_column <span class="op">=</span> <span class="st">"cf"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nEvents have been matched to unemployment periods.\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Events have been matched to unemployment periods.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"New attribute columns added for each event type.\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; New attribute columns added for each event type.</span></span>
<span></span>
<span><span class="co"># Check which columns were added</span></span>
<span><span class="va">event_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"_attribute$"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data_with_events</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Event attribute columns:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">event_cols</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Event attribute columns: training_program_attribute, policy_change_attribute, subsidy_program_attribute</span></span>
<span></span>
<span><span class="co"># Show unemployment periods with matched events</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">event_cols</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">unemployment_with_events</span> <span class="op">&lt;-</span> <span class="va">data_with_events</span><span class="op">[</span><span class="va">arco</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">col</span> <span class="kw">in</span> <span class="va">event_cols</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">unemployment_with_events</span><span class="op">[[</span><span class="va">col</span><span class="op">]</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nUnemployment periods with"</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_attribute"</span>, <span class="st">""</span>, <span class="va">col</span><span class="op">)</span>, <span class="st">":\n"</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">unemployment_with_events</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fu">.</span><span class="op">(</span><span class="va">cf</span>, <span class="va">inizio</span>, <span class="va">fine</span>, <span class="va">durata</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nNo events matched to unemployment periods in this dataset.\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Unemployment periods with training_program :</span></span>
<span><span class="co">#&gt;           cf     inizio       fine     durata</span></span>
<span><span class="co">#&gt;       &lt;char&gt;     &lt;Date&gt;     &lt;Date&gt; &lt;difftime&gt;</span></span>
<span><span class="co">#&gt; 1: PERSON001 2023-04-01 2023-05-31    61 days</span></span>
<span><span class="co">#&gt; 2: PERSON005 2023-04-01 2023-04-30    30 days</span></span>
<span><span class="co">#&gt; 3:      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;    NA days</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Unemployment periods with subsidy_program :</span></span>
<span><span class="co">#&gt;           cf     inizio       fine     durata</span></span>
<span><span class="co">#&gt;       &lt;char&gt;     &lt;Date&gt;     &lt;Date&gt; &lt;difftime&gt;</span></span>
<span><span class="co">#&gt; 1: PERSON001 2023-04-01 2023-05-31    61 days</span></span>
<span><span class="co">#&gt; 2: PERSON005 2023-04-01 2023-04-30    30 days</span></span>
<span><span class="co">#&gt; 3:      &lt;NA&gt;       &lt;NA&gt;       &lt;NA&gt;    NA days</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="merging-consecutive-employment">8.2 Merging Consecutive Employment<a class="anchor" aria-label="anchor" href="#merging-consecutive-employment"></a>
</h3>
<p>When analyzing employment stability, you may want to consolidate
consecutive periods of the same employment type.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 8.2 Merge consecutive employment periods -----</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Before merging consecutive periods:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Before merging consecutive periods:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Total segments:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">classified_data</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Total segments: 76</span></span>
<span></span>
<span><span class="va">merged_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_consecutive_employment.html">merge_consecutive_employment</a></span><span class="op">(</span></span>
<span>  <span class="va">classified_data</span>,</span>
<span>  consolidation_type <span class="op">=</span> <span class="st">"both"</span>  <span class="co"># Consolidate both overlapping and consecutive</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nAfter merging consecutive periods:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; After merging consecutive periods:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Total segments:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">merged_data</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Total segments: 30</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Reduction:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">classified_data</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">merged_data</span><span class="op">)</span>, <span class="st">"segments\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reduction: 46 segments</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Reduction percentage:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">merged_data</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">classified_data</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reduction percentage: 60.5 %</span></span>
<span></span>
<span><span class="co"># Check consolidation statistics</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="st">"collapsed"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">merged_data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nConsolidation details:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Periods marked as collapsed:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">merged_data</span><span class="op">$</span><span class="va">collapsed</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Consolidation details:</span></span>
<span><span class="co">#&gt; - Periods marked as collapsed: 12</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="st">"n_periods"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">merged_data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">consolidated_summary</span> <span class="op">&lt;-</span> <span class="va">merged_data</span><span class="op">[</span><span class="va">n_periods</span> <span class="op">&gt;</span> <span class="fl">1</span>, <span class="fu">.</span><span class="op">(</span></span>
<span>    max_periods_merged <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">n_periods</span><span class="op">)</span>,</span>
<span>    avg_periods_merged <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">n_periods</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    total_consolidated_groups <span class="op">=</span> <span class="va">.N</span></span>
<span>  <span class="op">)</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Maximum periods merged:"</span>, <span class="va">consolidated_summary</span><span class="op">$</span><span class="va">max_periods_merged</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Average periods merged:"</span>, <span class="va">consolidated_summary</span><span class="op">$</span><span class="va">avg_periods_merged</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Total consolidated groups:"</span>, <span class="va">consolidated_summary</span><span class="op">$</span><span class="va">total_consolidated_groups</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Compare segment counts by person</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n\nPer-person segment reduction:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Per-person segment reduction:</span></span>
<span><span class="va">segment_comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>  cf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">classified_data</span><span class="op">$</span><span class="va">cf</span><span class="op">)</span>,</span>
<span>  before <span class="op">=</span> <span class="va">classified_data</span><span class="op">[</span>, <span class="va">.N</span>, by <span class="op">=</span> <span class="va">cf</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">cf</span><span class="op">)</span><span class="op">]</span><span class="op">$</span><span class="va">N</span>,</span>
<span>  after <span class="op">=</span> <span class="va">merged_data</span><span class="op">[</span>, <span class="va">.N</span>, by <span class="op">=</span> <span class="va">cf</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">cf</span><span class="op">)</span><span class="op">]</span><span class="op">$</span><span class="va">N</span></span>
<span><span class="op">)</span></span>
<span><span class="va">segment_comparison</span><span class="op">[</span>, <span class="va">reduction</span> <span class="op">:=</span> <span class="va">before</span> <span class="op">-</span> <span class="va">after</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">segment_comparison</span><span class="op">[</span><span class="va">reduction</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;           cf before after reduction</span></span>
<span><span class="co">#&gt;       &lt;char&gt;  &lt;int&gt; &lt;int&gt;     &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1: PERSON001      7     3         4</span></span>
<span><span class="co">#&gt; 2: PERSON002     13     1        12</span></span>
<span><span class="co">#&gt; 3: PERSON003      5     1         4</span></span>
<span><span class="co">#&gt; 4: PERSON004      8     5         3</span></span>
<span><span class="co">#&gt; 5: PERSON005     11     9         2</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="understanding-over_id-consolidation">8.3 Understanding over_id Consolidation<a class="anchor" aria-label="anchor" href="#understanding-over_id-consolidation"></a>
</h3>
<p>The over_id system is a key innovation in vecshift that identifies
continuous overlapping employment periods.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 8.3 Understanding over_id consolidation -----</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Understanding over_id:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Understanding over_id:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"======================\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ======================</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"over_id groups continuous employment periods, even with overlaps.\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; over_id groups continuous employment periods, even with overlaps.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Same over_id value = continuous overlapping employment period\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Same over_id value = continuous overlapping employment period</span></span>
<span></span>
<span><span class="co"># Find persons with overlapping employment</span></span>
<span><span class="va">overlapping_persons</span> <span class="op">&lt;-</span> <span class="va">processed_data</span><span class="op">[</span><span class="va">arco</span> <span class="op">&gt;</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">cf</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">overlapping_persons</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Example of overlapping employment with over_id:\n"</span><span class="op">)</span></span>
<span>  <span class="va">example_person</span> <span class="op">&lt;-</span> <span class="va">overlapping_persons</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">example_data</span> <span class="op">&lt;-</span> <span class="va">processed_data</span><span class="op">[</span><span class="va">cf</span> <span class="op">==</span> <span class="va">example_person</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">inizio</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">example_data</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">cf</span>, <span class="va">inizio</span>, <span class="va">fine</span>, <span class="va">arco</span>, <span class="va">over_id</span>, <span class="va">durata</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n\nNotice how over_id groups overlapping periods together.\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"This allows you to:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Identify continuous employment spans\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Track employment intensity changes within a period\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Consolidate periods while preserving overlap information\n"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"This dataset has no overlapping employment periods.\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"In datasets with overlaps, over_id would show:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Same over_id for all segments in a continuous employment period\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Different over_id values for separate employment periods\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Example of overlapping employment with over_id:</span></span>
<span><span class="co">#&gt; Key: &lt;cf, inizio, fine&gt;</span></span>
<span><span class="co">#&gt;            cf     inizio       fine  arco over_id     durata</span></span>
<span><span class="co">#&gt;        &lt;char&gt;     &lt;Date&gt;     &lt;Date&gt; &lt;num&gt;   &lt;int&gt; &lt;difftime&gt;</span></span>
<span><span class="co">#&gt;  1: PERSON002 2023-01-15 2023-02-01     1       7    18 days</span></span>
<span><span class="co">#&gt;  2: PERSON002 2023-02-01 2023-02-15     2       7    14 days</span></span>
<span><span class="co">#&gt;  3: PERSON002 2023-02-15 2023-03-31     3       7    44 days</span></span>
<span><span class="co">#&gt;  4: PERSON002 2023-03-31 2023-04-30     2       7    30 days</span></span>
<span><span class="co">#&gt;  5: PERSON002 2023-04-30 2023-05-01     1       7     1 days</span></span>
<span><span class="co">#&gt;  6: PERSON002 2023-05-01 2023-05-15     2       7    14 days</span></span>
<span><span class="co">#&gt;  7: PERSON002 2023-05-15 2023-06-30     3       7    46 days</span></span>
<span><span class="co">#&gt;  8: PERSON002 2023-06-30 2023-07-31     2       7    31 days</span></span>
<span><span class="co">#&gt;  9: PERSON002 2023-07-31 2023-08-01     1       7     1 days</span></span>
<span><span class="co">#&gt; 10: PERSON002 2023-08-01 2023-09-01     2       7    31 days</span></span>
<span><span class="co">#&gt; 11: PERSON002 2023-09-01 2023-10-31     3       7    60 days</span></span>
<span><span class="co">#&gt; 12: PERSON002 2023-10-31 2023-11-01     1       7     1 days</span></span>
<span><span class="co">#&gt; 13: PERSON002 2023-11-01 2023-12-31     2       7    60 days</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Notice how over_id groups overlapping periods together.</span></span>
<span><span class="co">#&gt; This allows you to:</span></span>
<span><span class="co">#&gt; - Identify continuous employment spans</span></span>
<span><span class="co">#&gt; - Track employment intensity changes within a period</span></span>
<span><span class="co">#&gt; - Consolidate periods while preserving overlap information</span></span>
<span></span>
<span><span class="co"># Show over_id distribution</span></span>
<span><span class="va">over_id_summary</span> <span class="op">&lt;-</span> <span class="va">processed_data</span><span class="op">[</span><span class="va">over_id</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="fu">.</span><span class="op">(</span></span>
<span>  segments_in_group <span class="op">=</span> <span class="va">.N</span>,</span>
<span>  total_duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">durata</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  has_overlap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">arco</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span>, by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">cf</span>, <span class="va">over_id</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">cf</span>, <span class="va">over_id</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n\nover_id Summary (employment periods only):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; over_id Summary (employment periods only):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">over_id_summary</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;            cf over_id segments_in_group total_duration has_overlap</span></span>
<span><span class="co">#&gt;        &lt;char&gt;   &lt;int&gt;             &lt;int&gt;          &lt;num&gt;      &lt;lgcl&gt;</span></span>
<span><span class="co">#&gt;  1: PERSON001       1                 1             31       FALSE</span></span>
<span><span class="co">#&gt;  2: PERSON001       2                 1             28       FALSE</span></span>
<span><span class="co">#&gt;  3: PERSON001       3                 1             31       FALSE</span></span>
<span><span class="co">#&gt;  4: PERSON001       4                 1             30       FALSE</span></span>
<span><span class="co">#&gt;  5: PERSON001       5                 1             62       FALSE</span></span>
<span><span class="co">#&gt;  6: PERSON001       6                 1            122       FALSE</span></span>
<span><span class="co">#&gt;  7: PERSON002       7                13            351        TRUE</span></span>
<span><span class="co">#&gt;  8: PERSON003       8                 1             59       FALSE</span></span>
<span><span class="co">#&gt;  9: PERSON003       9                 1             61       FALSE</span></span>
<span><span class="co">#&gt; 10: PERSON003      10                 1             61       FALSE</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="pipeline-processing">9. Pipeline Processing<a class="anchor" aria-label="anchor" href="#pipeline-processing"></a>
</h2>
<p>For production workflows, use the integrated pipeline function that
combines all processing steps efficiently.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 9. Integrated pipeline processing -----</span></span>
<span><span class="co"># Check pipeline readiness</span></span>
<span><span class="va">pipeline_check</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_pipeline_functions.html">check_pipeline_functions</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Pipeline Function Availability:\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pipeline_check</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get recommendations based on data characteristics</span></span>
<span><span class="va">recommendations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_pipeline_recommendations.html">get_pipeline_recommendations</a></span><span class="op">(</span></span>
<span>  <span class="va">employment_raw</span>,</span>
<span>  target_operation <span class="op">=</span> <span class="st">"analysis"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n\nPipeline Recommendations:\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Target operation:"</span>, <span class="va">recommendations</span><span class="op">$</span><span class="va">data_summary</span><span class="op">$</span><span class="va">target_operation</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Recommended settings:\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">recommendations</span><span class="op">$</span><span class="va">recommendations</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">recommendations</span><span class="op">$</span><span class="va">warnings</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nWarnings:\n"</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">warning</span> <span class="kw">in</span> <span class="va">recommendations</span><span class="op">$</span><span class="va">warnings</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="va">warning</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Run the complete pipeline (example - we already processed the data above)</span></span>
<span><span class="co"># In production, you would use this instead of individual steps:</span></span>
<span><span class="va">pipeline_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_employment_pipeline.html">process_employment_pipeline</a></span><span class="op">(</span></span>
<span>  original_data <span class="op">=</span> <span class="va">employment_raw</span>,</span>
<span>  apply_vecshift <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  classify_status <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  collapse_consecutive <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  consolidate_periods <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  consolidation_type <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>  validate_over_id <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  show_progress <span class="op">=</span> <span class="cn">FALSE</span>  <span class="co"># Set to TRUE to see progress bar</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nPipeline execution complete!\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Output rows:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pipeline_result</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Access pipeline metadata</span></span>
<span><span class="va">pipeline_steps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">pipeline_result</span>, <span class="st">"pipeline_steps"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nPipeline steps applied:\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pipeline_steps</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Access validation results</span></span>
<span><span class="va">validation_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">pipeline_result</span>, <span class="st">"validation_results"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">validation_results</span><span class="op">$</span><span class="va">over_id</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nover_id validation:"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">validation_results</span><span class="op">$</span><span class="va">over_id</span><span class="op">$</span><span class="va">all_tests_passed</span>, <span class="st">"PASSED"</span>, <span class="st">"FAILED"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="best-practices-and-next-steps">10. Best Practices and Next Steps<a class="anchor" aria-label="anchor" href="#best-practices-and-next-steps"></a>
</h2>
<div class="section level3">
<h3 id="best-practices">Best Practices<a class="anchor" aria-label="anchor" href="#best-practices"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<strong>Always validate input data</strong> before processing
<ul>
<li>Use <code><a href="../reference/assess_data_quality.html">assess_data_quality()</a></code> to identify issues</li>
<li>Check for invalid date ranges, missing values, and duplicates</li>
<li>Clean data with <code><a href="../reference/clean_employment_data.html">clean_employment_data()</a></code> if needed</li>
</ul>
</li>
<li>
<strong>Use the pipeline functions</strong> for production workflows
<ul>
<li>
<code><a href="../reference/process_employment_pipeline.html">process_employment_pipeline()</a></code> handles the complete
workflow</li>
<li>Get recommendations with
<code><a href="../reference/get_pipeline_recommendations.html">get_pipeline_recommendations()</a></code>
</li>
<li>Enable progress bars with <code>show_progress = TRUE</code> for
long-running operations</li>
</ul>
</li>
<li>
<strong>Understand your consolidation strategy</strong>
<ul>
<li>Use <code>consolidation_type = "both"</code> for comprehensive
analysis</li>
<li>Use <code>consolidation_type = "overlapping"</code> to preserve
consecutive distinctions</li>
<li>Use <code>consolidation_type = "consecutive"</code> for traditional
merging</li>
</ul>
</li>
<li>
<strong>Leverage over_id for advanced analysis</strong>
<ul>
<li>over_id identifies continuous employment periods</li>
<li>Use it to track employment stability and transitions</li>
<li>Consolidate periods while preserving temporal precision</li>
</ul>
</li>
<li>
<strong>Validate output after transformation</strong>
<ul>
<li>Use <code><a href="../reference/validate_status_classifications.html">validate_status_classifications()</a></code> to check
classification integrity</li>
<li>Verify temporal continuity for critical persons</li>
<li>Check the duration invariant with validation functions</li>
</ul>
</li>
<li>
<strong>Document custom status rules</strong> for reproducibility
<ul>
<li>Create clear prior_labels mappings for industry-specific codes</li>
<li>Document unemployment thresholds and their business rationale</li>
<li>Use descriptive status labels that reflect your context</li>
</ul>
</li>
</ol>
</div>
<div class="section level3">
<h3 id="common-troubleshooting-scenarios">Common Troubleshooting Scenarios<a class="anchor" aria-label="anchor" href="#common-troubleshooting-scenarios"></a>
</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Issue 1: Invalid date ranges</span></span>
<span><span class="co"># Solution: Use data quality assessment and cleaning</span></span>
<span><span class="va">problematic_data</span> <span class="op">&lt;-</span> <span class="va">employment_raw</span></span>
<span><span class="va">problematic_data</span><span class="op">[</span><span class="fl">1</span>, <span class="va">fine</span> <span class="op">:=</span> <span class="va">inizio</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span>  <span class="co"># Create invalid range</span></span>
<span></span>
<span><span class="va">quality_check</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assess_data_quality.html">assess_data_quality</a></span><span class="op">(</span><span class="va">problematic_data</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">quality_check</span><span class="op">$</span><span class="va">date_issues</span><span class="op">$</span><span class="va">n_invalid_ranges</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Invalid date ranges detected - cleaning required\n"</span><span class="op">)</span></span>
<span>  <span class="va">cleaned_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_employment_data.html">clean_employment_data</a></span><span class="op">(</span></span>
<span>    <span class="va">problematic_data</span>,</span>
<span>    remove_invalid_dates <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Issue 2: Custom column names</span></span>
<span><span class="co"># Solution: Use standardize_columns()</span></span>
<span><span class="va">custom_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">"contract_id"</span>,</span>
<span>  cf <span class="op">=</span> <span class="st">"person_code"</span>,</span>
<span>  inizio <span class="op">=</span> <span class="st">"start_date"</span>,</span>
<span>  fine <span class="op">=</span> <span class="st">"end_date"</span>,</span>
<span>  prior <span class="op">=</span> <span class="st">"employment_type"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># standardized_data &lt;- standardize_columns(your_data, custom_cols)</span></span>
<span></span>
<span><span class="co"># Issue 3: Custom employment type codes</span></span>
<span><span class="co"># Solution: Create custom status rules with prior_labels</span></span>
<span><span class="va">custom_rules</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_custom_status_rules.html">create_custom_status_rules</a></span><span class="op">(</span></span>
<span>  prior_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"0"</span> <span class="op">=</span> <span class="st">"pt"</span>,</span>
<span>    <span class="st">"1"</span> <span class="op">=</span> <span class="st">"ft"</span>,</span>
<span>    <span class="st">"2"</span> <span class="op">=</span> <span class="st">"fixed_term"</span>,</span>
<span>    <span class="st">"3"</span> <span class="op">=</span> <span class="st">"temporary"</span>,</span>
<span>    <span class="st">"4"</span> <span class="op">=</span> <span class="st">"apprentice"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># classified_custom &lt;- classify_employment_status(processed_data, rules = custom_rules)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h3>
<div class="section level4">
<h4 id="advanced-analytics-with-longworkr">Advanced Analytics with longworkR<a class="anchor" aria-label="anchor" href="#advanced-analytics-with-longworkr"></a>
</h4>
<p>For analysis beyond temporal transformation, consider the companion
package longworkR:</p>
<ul>
<li>
<strong>Survival Analysis</strong>: Analyze contract duration and
termination patterns</li>
<li>
<strong>Impact Evaluation</strong>: Difference-in-differences,
propensity score matching, event studies</li>
<li>
<strong>Network Analysis</strong>: Map employment transition
networks and career pathways</li>
<li>
<strong>Interactive Visualization</strong>: Create dashboards with
ggraph and g6r</li>
</ul>
<p>See the longworkR package documentation at <code>../longworkR</code>
for details.</p>
</div>
<div class="section level4">
<h4 id="performance-optimization-for-large-datasets">Performance Optimization for Large Datasets<a class="anchor" aria-label="anchor" href="#performance-optimization-for-large-datasets"></a>
</h4>
<p>When working with large datasets (&gt;100,000 records):</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Process in chunks by person or time period</span></span>
<span><span class="va">large_data_chunk1</span> <span class="op">&lt;-</span> <span class="va">large_data</span><span class="op">[</span><span class="va">cf</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">person_ids</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">result_chunk1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vecshift.html">vecshift</a></span><span class="op">(</span><span class="va">large_data_chunk1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Disable progress bars for batch processing</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_employment_pipeline.html">process_employment_pipeline</a></span><span class="op">(</span></span>
<span>  <span class="va">large_data</span>,</span>
<span>  show_progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Use data.table operations efficiently</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkey</a></span><span class="op">(</span><span class="va">processed_data</span>, <span class="va">cf</span>, <span class="va">inizio</span><span class="op">)</span>  <span class="co"># Set keys for faster operations</span></span>
<span></span>
<span><span class="co"># 4. Consider parallel processing for independent person-level analyses</span></span>
<span><span class="co"># (Note: vecshift itself is already optimized at ~1.46M records/second)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="integration-with-other-systems">Integration with Other Systems<a class="anchor" aria-label="anchor" href="#integration-with-other-systems"></a>
</h4>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Export processed data</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span><span class="va">classified_data</span>, <span class="st">"processed_employment_data.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Integration with databases</span></span>
<span><span class="co"># library(DBI)</span></span>
<span><span class="co"># con &lt;- dbConnect(...)</span></span>
<span><span class="co"># dbWriteTable(con, "employment_segments", classified_data)</span></span>
<span></span>
<span><span class="co"># Create summary reports</span></span>
<span><span class="va">summary_report</span> <span class="op">&lt;-</span> <span class="va">classified_data</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span></span>
<span>  total_segments <span class="op">=</span> <span class="va">.N</span>,</span>
<span>  employment_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">durata</span><span class="op">[</span><span class="va">arco</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">durata</span><span class="op">)</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  avg_segment_duration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">durata</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  has_overlaps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">arco</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span>, by <span class="op">=</span> <span class="va">cf</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span><span class="va">summary_report</span>, <span class="st">"employment_summary.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>This vignette demonstrated a complete vecshift workflow:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Data Preparation</strong>: Created realistic employment data
with varied patterns</li>
<li>
<strong>Quality Assessment</strong>: Assessed data quality and
validated input</li>
<li>
<strong>Transformation</strong>: Applied vecshift() to create
temporal segments with over_id</li>
<li>
<strong>Classification</strong>: Added employment status labels with
flexible rules</li>
<li>
<strong>Validation</strong>: Ensured temporal consistency and
classification integrity</li>
<li>
<strong>Analysis</strong>: Extracted insights from employment
patterns and transitions</li>
<li>
<strong>Advanced Features</strong>: Applied external events and
period consolidation</li>
<li>
<strong>Pipeline Processing</strong>: Integrated workflow for
production use</li>
</ol>
<div class="section level3">
<h3 id="key-takeaways">Key Takeaways<a class="anchor" aria-label="anchor" href="#key-takeaways"></a>
</h3>
<ul>
<li>vecshift transforms employment contracts into continuous temporal
segments</li>
<li>over_id identifies and groups continuous overlapping employment
periods</li>
<li>The modular architecture separates core transformation from business
logic</li>
<li>Comprehensive validation ensures temporal and logical
consistency</li>
<li>The pipeline approach streamlines production workflows</li>
<li>Advanced features support specialized analysis scenarios</li>
</ul>
</div>
<div class="section level3">
<h3 id="further-reading">Further Reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h3>
<ul>
<li>
<strong>Understanding Date Logic</strong>: See
<code><a href="../articles/understanding-date-logic.html">vignette("understanding-date-logic")</a></code> for detailed date
handling rules</li>
<li>
<strong>Status Classification</strong>: See
<code><a href="../articles/status-classification.html">vignette("status-classification")</a></code> for advanced
classification patterns</li>
<li>
<strong>Function Reference</strong>: See <code><a href="../reference/vecshift.html">?vecshift</a></code>,
<code><a href="../reference/classify_employment_status.html">?classify_employment_status</a></code>, and related function
documentation</li>
<li>
<strong>longworkR Integration</strong>: See the longworkR package
for advanced analytics and visualization</li>
</ul>
<p>The vecshift package provides a robust foundation for temporal
employment analysis, with the flexibility to adapt to diverse business
contexts while maintaining high performance and data integrity.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/gmontaletti" class="external-link">Giampaolo Montaletti</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
